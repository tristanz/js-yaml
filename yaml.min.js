(function(exports,global){function context(str){return"string"!=typeof str?"":(str=str.slice(0,25).replace(/\n/g,"\\n").replace(/"/g,'\\"'),'near "'+str+'"')}function Parser(tokens){this.tokens=tokens}global.yaml=exports,exports.version="0.2.3";var tokens=[["comment",/^#[^\n]*/],["indent",/^\n( *)/],["space",/^ +/],["true",/^\b(enabled|true|yes|on)\b/],["false",/^\b(disabled|false|no|off)\b/],["null",/^\b(null|Null|NULL|~)\b/],["string",/^"(.*?)"/],["string",/^'(.*?)'/],["timestamp",/^((\d{4})-(\d\d?)-(\d\d?)(?:(?:[ \t]+)(\d\d?):(\d\d)(?::(\d\d))?)?)/],["float",/^(\d+\.\d+)/],["int",/^(\d+)/],["doc",/^---/],[",",/^,/],["{",/^\{(?![^\n\}]*\}[^\n]*[^\s\n\}])/],["}",/^\}/],["[",/^\[(?![^\n\]]*\][^\n]*[^\s\n\]])/],["]",/^\]/],["-",/^\-/],[":",/^[:]/],["string",/^(?![^:\n\s]*:[^\/]{2})(([^:,\]\}\n\s]|(?!\n)\s(?!\s*?\n)|:\/\/|,(?=[^\n]*\s*[^\]\}\s\n]\s*\n)|[\]\}](?=[^\n]*\s*[^\]\}\s\n]\s*\n))*)(?=[,:\]\}\s\n]|$)/],["id",/^([\w][\w -]*)/]];exports.tokenize=function(str){var token,captures,ignore,input,indents=0,lastIndents=0,stack=[],indentAmount=-1;for(str=str.replace(/\r\n/g,"\n");str.length;){for(var i=0,len=tokens.length;len>i;++i)if(captures=tokens[i][1].exec(str)){switch(token=[tokens[i][0],captures],str=str.replace(tokens[i][1],""),token[0]){case"comment":ignore=!0;break;case"indent":if(lastIndents=indents,-1==indentAmount&&(indentAmount=token[1][1].length),indents=token[1][1].length/indentAmount,indents===lastIndents)ignore=!0;else{if(indents>lastIndents+1)throw new SyntaxError("invalid indentation, got "+indents+" instead of "+(lastIndents+1));if(lastIndents>indents)for(input=token[1].input,token=["dedent"],token.input=input;--lastIndents>indents;)stack.push(token)}}break}if(!ignore){if(!token)throw new SyntaxError(context(str));stack.push(token),token=null}ignore=!1}return stack},Parser.prototype.peek=function(){return this.tokens[0]},Parser.prototype.advance=function(){return this.tokens.shift()},Parser.prototype.advanceValue=function(){return this.advance()[1][1]},Parser.prototype.accept=function(type){return this.peekType(type)?this.advance():void 0},Parser.prototype.expect=function(type,msg){if(!this.accept(type))throw Error(msg+", "+context(this.peek()[1].input))},Parser.prototype.peekType=function(val){return this.tokens[0]&&this.tokens[0][0]===val},Parser.prototype.ignoreSpace=function(){for(;this.peekType("space");)this.advance()},Parser.prototype.ignoreWhitespace=function(){for(;this.peekType("space")||this.peekType("indent")||this.peekType("dedent");)this.advance()},Parser.prototype.parse=function(){switch(this.peek()[0]){case"doc":return this.parseDoc();case"-":return this.parseList();case"{":return this.parseInlineHash();case"[":return this.parseInlineList();case"id":return this.parseHash();case"string":return this.advanceValue();case"timestamp":return this.parseTimestamp();case"float":return parseFloat(this.advanceValue());case"int":return parseInt(this.advanceValue());case"true":return this.advanceValue(),!0;case"false":return this.advanceValue(),!1;case"null":return this.advanceValue(),null}},Parser.prototype.parseDoc=function(){this.accept("doc"),this.expect("indent","expected indent after document");var val=this.parse();return this.expect("dedent","document not properly dedented"),val},Parser.prototype.parseHash=function(){for(var id,hash={};this.peekType("id")&&(id=this.advanceValue());)this.expect(":","expected semi-colon after id"),this.ignoreSpace(),this.accept("indent")?(hash[id]=this.parse(),this.expect("dedent","hash not properly dedented")):hash[id]=this.parse(),this.ignoreSpace();return hash},Parser.prototype.parseInlineHash=function(){var id,hash={},i=0;for(this.accept("{");!this.accept("}");)this.ignoreSpace(),i&&this.expect(",","expected comma"),this.ignoreWhitespace(),this.peekType("id")&&(id=this.advanceValue())&&(this.expect(":","expected semi-colon after id"),this.ignoreSpace(),hash[id]=this.parse(),this.ignoreWhitespace()),++i;return hash},Parser.prototype.parseList=function(){for(var list=[];this.accept("-");)this.ignoreSpace(),this.accept("indent")?(list.push(this.parse()),this.expect("dedent","list item not properly dedented")):list.push(this.parse()),this.ignoreSpace();return list},Parser.prototype.parseInlineList=function(){var list=[],i=0;for(this.accept("[");!this.accept("]");)this.ignoreSpace(),i&&this.expect(",","expected comma"),this.ignoreSpace(),list.push(this.parse()),this.ignoreSpace(),++i;return list},Parser.prototype.parseTimestamp=function(){var token=this.advance()[1],date=new Date,year=token[2],month=token[3],day=token[4],hour=token[5]||0,min=token[6]||0,sec=token[7]||0;return date.setUTCFullYear(year,month-1,day),date.setUTCHours(hour),date.setUTCMinutes(min),date.setUTCSeconds(sec),date.setUTCMilliseconds(0),date},exports.eval=function(str){return new Parser(exports.tokenize(str)).parse()}})({},function(){return this}());